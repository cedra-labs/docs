"use strict";(self.webpackChunkcedra_docs=self.webpackChunkcedra_docs||[]).push([[640],{3134:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"guides/dex/understanding-amm","title":"Understanding Automated Market Makers on Cedra","description":"Automated Market Makers (AMMs) revolutionized decentralized trading by replacing traditional order books with mathematical formulas. This tutorial teaches you the core concepts behind AMMs and how they work on Cedra blockchain.","source":"@site/docs/guides/dex/understanding-amm.md","sourceDirName":"guides/dex","slug":"/guides/dex/understanding-amm","permalink":"/guides/dex/understanding-amm","draft":false,"unlisted":false,"editUrl":"https://github.com/cedra-labs/docs/edit/main/docs/guides/dex/understanding-amm.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Build a DEX on Cedra - Complete Guide","permalink":"/guides/dex/"},"next":{"title":"Building Your First Trading Pair","permalink":"/guides/dex/first-trading-pair"}}');var r=n(4848),s=n(8453);const a={},l="Understanding Automated Market Makers on Cedra",o={},d=[{value:"What You&#39;ll Learn",id:"what-youll-learn",level:2},{value:"The Constant Product Formula",id:"the-constant-product-formula",level:2},{value:"Price Impact in Action",id:"price-impact-in-action",level:3},{value:"The 0.3% Standard",id:"the-03-standard",level:3},{value:"Liquidity Provider Tokens",id:"liquidity-provider-tokens",level:2},{value:"Real-World Applications",id:"real-world-applications",level:2},{value:"1. Decentralized Trading",id:"1-decentralized-trading",level:3},{value:"2. Price Discovery",id:"2-price-discovery",level:3},{value:"3. Yield Generation",id:"3-yield-generation",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"Building Your First Trading Pair",id:"building-your-first-trading-pair",level:3},{value:"Adding Price Protection Mechanisms",id:"adding-price-protection-mechanisms",level:3},{value:"Multi-hop Routing for Optimal Execution",id:"multi-hop-routing-for-optimal-execution",level:3},{value:"DEX Client Integration Guide",id:"dex-client-integration-guide",level:3}];function c(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"understanding-automated-market-makers-on-cedra",children:"Understanding Automated Market Makers on Cedra"})}),"\n",(0,r.jsx)(i.p,{children:"Automated Market Makers (AMMs) revolutionized decentralized trading by replacing traditional order books with mathematical formulas. This tutorial teaches you the core concepts behind AMMs and how they work on Cedra blockchain."}),"\n",(0,r.jsx)(i.h2,{id:"what-youll-learn",children:"What You'll Learn"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"How the constant product formula (x*y=k) works"}),"\n",(0,r.jsx)(i.li,{children:"Why AMMs are essential for DeFi"}),"\n",(0,r.jsx)(i.li,{children:"How trading fees benefit liquidity providers"}),"\n",(0,r.jsx)(i.li,{children:"Real-world applications and use cases"}),"\n"]}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"the-constant-product-formula",children:"The Constant Product Formula"}),"\n",(0,r.jsxs)(i.p,{children:["AMMs use a simple yet powerful formula: ",(0,r.jsx)(i.strong,{children:"x * y = k"})]}),"\n",(0,r.jsx)(i.p,{children:"Where:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"x"})," = quantity of token A in the pool"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"y"})," = quantity of token B in the pool"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"k"})," = constant product (remains unchanged during swaps)"]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"Imagine a pool with:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"1,000 ETH (x)"}),"\n",(0,r.jsx)(i.li,{children:"2,000,000 USDC (y)"}),"\n",(0,r.jsx)(i.li,{children:"k = 1,000 * 2,000,000 = 2,000,000,000"}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"When someone buys 10 ETH:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"ETH in pool decreases: 1,000 - 10 = 990"}),"\n",(0,r.jsx)(i.li,{children:"To maintain k, USDC must increase: 2,000,000,000 / 990 = 2,020,202"}),"\n",(0,r.jsx)(i.li,{children:"User pays: 2,020,202 - 2,000,000 = 20,202 USDC"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"price-impact-in-action",children:"Price Impact in Action"}),"\n",(0,r.jsx)(i.p,{children:"The relationship between trade size and price impact isn't linear - it's exponential. This fundamental property of the constant product formula protects pools from being drained while ensuring continuous liquidity availability. Let's explore this through a practical demonstration that shows how dramatically prices change as trades get larger."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-rust",children:"module tutorial::amm_demo {\n    use simple_dex::math_amm;\n    \n    #[test]\n    fun demonstrate_price_impact() {\n        // Initialize our pool with a 1:2000 ETH/USDC ratio\n        // This represents a typical mid-sized liquidity pool\n        let reserve_eth = 1000000; // 1,000 ETH with 6 decimal precision\n        let reserve_usdc = 2000000000; // 2,000,000 USDC establishing $2000/ETH price\n        \n        // Small trades barely move the price - this is what enables\n        // efficient trading for regular users. The pool can handle\n        // many small trades without significant price deterioration\n        let small_output = math_amm::get_amount_out(\n            1000000, // Trading just 1 ETH\n            reserve_eth,\n            reserve_usdc\n        );\n        // The output is approximately 1,996 USDC, showing only 0.2% slippage\n        // This minor price impact makes the pool attractive for traders\n        \n        // Large trades tell a different story. As trade size increases\n        // relative to pool reserves, the price impact grows exponentially\n        // This natural mechanism prevents pool manipulation\n        let large_output = math_amm::get_amount_out(\n            100000000, // Trading 100 ETH (10% of pool)\n            reserve_eth,\n            reserve_usdc\n        );\n        // The total output is ~181,488 USDC for 100 ETH\n        // That's only 1,814.88 per ETH - a 9.2% price impact!\n        // This dramatic difference protects the pool while rewarding liquidity providers\n    }\n}\n\n"})}),"\n",(0,r.jsx)(i.p,{children:"This exponential price curve serves multiple purposes: it maintains pool stability by making large trades increasingly expensive, creates arbitrage opportunities that keep prices aligned across markets, and ensures there's always liquidity available at some price point. The beauty of this system lies in its simplicity - no complex order matching or market makers needed, just pure mathematics ensuring fair and continuous trading."}),"\n",(0,r.jsx)(i.admonition,{title:"View Complete Math Module",type:"tip",children:(0,r.jsxs)(i.p,{children:["Explore all AMM math functions: ",(0,r.jsx)(i.a,{href:"https://github.com/cedra-labs/move-contract-examples/blob/main/dex/sources/1-math-amm.move",children:(0,r.jsx)(i.code,{children:"math_amm.move"})})]})}),"\n",(0,r.jsx)(i.h3,{id:"the-03-standard",children:"The 0.3% Standard"}),"\n",(0,r.jsx)(i.p,{children:"Every swap incurs a 0.3% fee, which:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Compensates liquidity providers for impermanent loss risk"}),"\n",(0,r.jsx)(i.li,{children:"Creates sustainable yield for the protocol"}),"\n",(0,r.jsx)(i.li,{children:"Prevents arbitrage attacks"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-rust",children:"// From math_amm.move\nlet amount_in_with_fee = (amount_in as u128) * 997u128; // 99.7% after 0.3% fee\nlet numerator = amount_in_with_fee * (reserve_out as u128);\nlet denominator = (reserve_in as u128) * 1000u128 + amount_in_with_fee;\n"})}),"\n",(0,r.jsx)(i.admonition,{title:"View Source",type:"tip",children:(0,r.jsxs)(i.p,{children:["See the complete implementation: ",(0,r.jsx)(i.a,{href:"https://github.com/cedra-labs/move-contract-examples/blob/main/dex/sources/1-math-amm.move#L12-L26",children:(0,r.jsx)(i.code,{children:"get_amount_out"})})]})}),"\n",(0,r.jsx)(i.p,{children:"Trading 100 USDC for ETH with 0.3% fee:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Effective input: 99.70 USDC"}),"\n",(0,r.jsx)(i.li,{children:"Fee collected: 0.30 USDC"}),"\n",(0,r.jsx)(i.li,{children:"Fee goes to liquidity providers"}),"\n"]}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"liquidity-provider-tokens",children:"Liquidity Provider Tokens"}),"\n",(0,r.jsx)(i.p,{children:"When you provide liquidity, you receive LP tokens representing your pool share:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-rust",children:"// Simplified LP calculation\nlet lp_amount = if (total_supply == 0) {\n    sqrt(amount_x * amount_y) // Initial liquidity\n} else {\n    min(\n        amount_x * total_supply / reserve_x,\n        amount_y * total_supply / reserve_y\n    )\n}\n"})}),"\n",(0,r.jsx)(i.admonition,{title:"View Source",type:"tip",children:(0,r.jsxs)(i.p,{children:["See LP token calculations in action: ",(0,r.jsx)(i.a,{href:"https://github.com/cedra-labs/move-contract-examples/blob/main/dex/sources/2-swap.move#L106-L163",children:(0,r.jsx)(i.code,{children:"add_liquidity"})})]})}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Initial Liquidity"}),": Alice adds 100 ETH + 200,000 USDC"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Receives: 1,414 LP tokens (sqrt(100 * 200,000))"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Second Provider"}),": Bob adds 50 ETH + 100,000 USDC"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Pool now has: 100 ETH + 200,000 USDC"}),"\n",(0,r.jsx)(i.li,{children:"Bob receives: 707 LP tokens (50% of Alice's share)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Fee Accumulation"}),": After $1M volume at 0.3% fee"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"$3,000 in fees added to pool"}),"\n",(0,r.jsx)(i.li,{children:"Alice's share: 66.67% = $2,000"}),"\n",(0,r.jsx)(i.li,{children:"Bob's share: 33.33% = $1,000"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"real-world-applications",children:"Real-World Applications"}),"\n",(0,r.jsx)(i.h3,{id:"1-decentralized-trading",children:"1. Decentralized Trading"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"No order books or market makers needed"}),"\n",(0,r.jsx)(i.li,{children:"24/7 liquidity availability"}),"\n",(0,r.jsx)(i.li,{children:"Permissionless trading"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"2-price-discovery",children:"2. Price Discovery"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Market-driven price determination"}),"\n",(0,r.jsx)(i.li,{children:"Arbitrage keeps prices aligned"}),"\n",(0,r.jsx)(i.li,{children:"Transparent pricing mechanism"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"3-yield-generation",children:"3. Yield Generation"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Passive income from trading fees"}),"\n",(0,r.jsx)(i.li,{children:"No active management required"}),"\n",(0,r.jsx)(i.li,{children:"Compound growth potential"}),"\n"]}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(i.p,{children:"You've learned how AMMs use the x*y=k formula to enable decentralized trading. Key takeaways:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Constant product formula maintains market equilibrium"}),"\n",(0,r.jsx)(i.li,{children:"Trading fees compensate liquidity providers"}),"\n",(0,r.jsx)(i.li,{children:"Price impact increases with trade size"}),"\n",(0,r.jsx)(i.li,{children:"LP tokens represent proportional pool ownership"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"building-your-first-trading-pair",children:(0,r.jsx)(i.a,{href:"./first-trading-pair",children:"Building Your First Trading Pair"})}),"\n",(0,r.jsx)(i.p,{children:"Hands-on implementation of a basic trading pair with swap, add liquidity, and remove liquidity functions."}),"\n",(0,r.jsx)(i.h3,{id:"adding-price-protection-mechanisms",children:(0,r.jsx)(i.a,{href:"./price-protection",children:"Adding Price Protection Mechanisms"})}),"\n",(0,r.jsx)(i.p,{children:"Implement slippage protection, minimum output amounts, and deadline checks to protect users."}),"\n",(0,r.jsx)(i.h3,{id:"multi-hop-routing-for-optimal-execution",children:(0,r.jsx)(i.a,{href:"./multi-hop-routing",children:"Multi-hop Routing for Optimal Execution"})}),"\n",(0,r.jsx)(i.p,{children:"Build a router that finds the best path through multiple pools for optimal trade execution."}),"\n",(0,r.jsx)(i.h3,{id:"dex-client-integration-guide",children:(0,r.jsx)(i.a,{href:"./client-integration",children:"DEX Client Integration Guide"})}),"\n",(0,r.jsx)(i.p,{children:"Create a TypeScript/React frontend that interacts with your DEX smart contracts."})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>l});var t=n(6540);const r={},s=t.createContext(r);function a(e){const i=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:i},e.children)}}}]);